<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<Title>"Board"</Title>

	<!-- BootStrap CSS CDN -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="./boardpage.css">
	<link rel="stylesheet" href="./navbar.css">


	<!-- Form Page Appears -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.js"></script>
	<script src="boardpage.js"></script>


	<!-- socket.io -->
	<script src="/socket.io/socket.io.js"></script>

	<!-- socketio-file-upload -->
	<script src="/siofu/client.js"></script>

	<script>
		$(document).ready(function () {
			var socket = io();
			const uploader = new SocketIOFileUpload(socket);
			var image_name;


			/*************************************************************************
			 * 
			 *         FOOD BOARD POST FEATURE - CLIENT SIDE
			 * 
			 *************************************************************************/
			/** Uploads the image in form to server, and grabs its name */
			uploader.listenOnSubmit(document.getElementById('submit'), document.getElementById('file-input'));
			uploader.addEventListener('start', (event) => {
				image_name = event.file.name;
			});

			/** Sends data from post-form to server.js */
			$('#submit').click(function () {
				console.log('Submit triggered!');

				socket.emit('post item', {
					name: $('#name').val(),
					description: $('#description').val(),
					dateTime: $('#datetimepicker').val(),
					foodgrouping: $('input[name=foodgrouping]:checked').val(),
					image: image_name
				});
				return false;
			});

			socket.on('post item return', (item) => {
				addNewItem(item.id, item.name, item.description, item.dateTime, item.foodgrouping, item.image);
			});


			/*************************************************************************
			 * 
			 *         FOOD BOARD LOAD FEATURE - CLIENT SIDE
			 * 
			 *************************************************************************/

			/**
			 * When the window is loaded, trigger websocket event for server to fetch foodboard posts
			 * from the data base. 
			 */
			$(window).on('load', () => {
				console.log('Client: page loaded');
				socket.emit('page loaded');
			});


			socket.on('load foodboard', (items) => {
				for (var i = 0; i < items.length; i++) {
					addNewItem(items[i].itemID, items[i].foodName, items[i].foodDescription, items[i].foodGroup, items[i].foodExpiryTime,
						items[i].foodImage);
				}
			});;


			/*************************************************************************
			 * 
			 *         FOOD BOARD DELETE FEATURE - CLIENT SIDE
			 * 
			 *************************************************************************/

			$('_claim-form').on('submit', (e) => {
				e.preventDefault();
				console.log(this.id);
			});

		});
	</script>


</head>

<body>
	<header>
		<header id="header">
			<div class="container-fluid">
				<nav class="navbar navbar-expand-sm navbar-fixed-top navbar-custom">
					<div class="nav navbar-brand">
						<a class="navbar-foodboard" href="./index.html">
							<img src="./Pictures/fb-logo-transparent.png" alt="FoodBoard">
						</a>
					</div>

					<!-- navbar logo for mobile-->
					<div class="nav navbar-brand-sm">
						<div class="text-center">

							<a class="navbar-foodboard" href="#page-top">
								<img src="./Pictures/fb-logo-transparent.png" alt="FoodBoard">
							</a>
						</div>
						<div class="navbar-right dropdown">
							<a class="btn btn-primary btn-lg dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown"></a>
							<ul class="dropdown-menu">
								<li class="nav-item text-center">
									<form action="/board">
										<input type="submit" class="linkButton" value="BOARD" />
									</form>
								</li>
								<li class="nav-item text-center">
									<a href="#our-team" class="nav-link-team">OUR TEAM</a>
								</li>
								<li class="nav-item text-center">
									<a href="#how-it-works" class="nav-link-value">VALUES</a>
								</li>
								<li class="nav-item text-center">
									<a href="#" class="nav-link" data-toggle="modal" data-target="#logreg-modal">LOGIN</a>
								</li>
							</ul>
						</div>
					</div>
					<!--Nav bar for Desktop-->
					<ul class="nav navbar-nav navbar-right navbar-right-custom">
						<li class="nav-item">
							<a href="#homepage-body-container" class="nav-link-about">ABOUT</a>
						</li>
						<li class="nav-item">
							<a href="#how-it-works" class="nav-link" class="nav-link-value">VALUES</a>
						</li>
						<li class="nav-item text-center">
							<a href="#our-team" class="nav-link" class="nav-link-team">OUR TEAM</a>
						</li>
						<li class="nav-item">
							<a href="" class="nav-link" data-toggle="modal" data-target="#logreg-modal">LOGIN</a>
						</li>
					</ul>
				</nav>
			</div>
		</header>
	</header>

	<!-- Contains contents of the board-->
	<div id="board">
		<div id='card-list'></div>
		<!-- Button to open modal-->
		<div class="fixed-top">
		<a id='add-item-button' class="btn additem" data-toggle="modal" data-target="#itemModal">
			<img id="add-icon" src="./Pictures/add-icon.png">
		</a>
		</div>
	</div>

	<!-- Contains all the divs related to adding a new food item-->
	<div class="container">

		<!-- This is the modal that will allow users to enter item info-->
		<div class="modal fade" id="itemModal">
			<div class="modal-dialog">
				<div class="modal-content">

					<!-- Modal Header-->
					<div class="modal-header">
						<h3 class="modal-title">New Food to Share</h3>
					</div>

					<!-- Modal Body-->
					<div class="modal-body">
						<!--Sets up the form when the modal is opened-->
						<form id="postForm" action="javascript:void(0);">

							<div class="form-group">
								<input id="name" type="text" class="form-control" placeholder="Enter food name" name="name">
							</div>

							<div class="form-group">
								<input id="description" type="text" class="form-control" placeholder="Enter food description" name="description" required>
							</div>

							<div class="form-group">
								<div class="input-group">
									<input id="datetimepicker" class="form-control " type="datetime-local" required>
								</div>
							</div>

							<!-- Radio button for food categories-->
							<div class="form-group">
								<div class="radio">
									<label>
										<input type="radio" name="foodgrouping" value="Produce">Produce</label>
									<label>
										<input type="radio" name="foodgrouping" value="Meat">Meat</label>
									<label>
										<input type="radio" name="foodgrouping" value="Packaged">Packaged</label>
									<label>
										<input type="radio" name="foodgrouping" value="Canned Goods">Canned Goods</label>
								</div>
							</div>

							<div class="form-group">
								<input id="file-input" type="file" accept="image/*">
								<output id="file-output"></output>
							</div>


							<input id="submit" type="submit" class="btn btn-primary" value="Submit">
						</form>
					</div>


				</div>
			</div>

		</div>
	</div>
	</script>

</body>

</html>